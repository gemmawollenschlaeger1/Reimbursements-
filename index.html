// Add receipt images to PDF
async function addReceipts(doc) {
    const files = receiptInput.files;
    if (!files.length) return;

    for (let i = 0; i < files.length; i++) {
        const file = files[i];

        // Only proceed if it is an image
        if (!file.type.startsWith("image/")) continue;

        const imgData = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                resolve(e.target.result);
            };
            reader.readAsDataURL(file);
        });

        // Calculate image dimensions
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 20;
        const maxWidth = pageWidth - margin * 2;

        const imgProps = doc.getImageProperties(imgData);
        const imgWidth = maxWidth;
        const imgHeight = (imgProps.height * imgWidth) / imgProps.width;

        // Add new page if needed
        if (imgHeight > pageHeight - margin * 2) {
            doc.addPage();
        }

        doc.addImage(imgData, 'JPEG', margin, margin, imgWidth, imgHeight);
        doc.addPage(); // separate receipts on new page
    }
}
